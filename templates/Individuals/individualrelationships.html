<style>
    .section-title1 {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-weight: 700;
        font-size: 2.3rem;
        color: #222222;
        letter-spacing: 0.05em;
        padding-bottom: 8px;
        text-transform: capitalize;
        margin: 5px 0 0 0;
    }
    
    /* Ensure dropdown menus are responsive */
    .dropdown-menu {
        max-width: 100vw;
        left: auto !important;
        right: 0 !important;
        font-size: 1.5rem;
    }
    
    .dropdown-menu li a {
        white-space: normal;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }

    @media (max-width: 767px) {
        .agents-panel .panel-heading {
            display: block !important;
        }
        
        .agents-panel .panel-heading h4 {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin: 0 0 10px 0;
            width: 100%;
            font-size: 1.8rem; /* Reduced for mobile */
        }

        .mobile-btn-container {
            display: flex;
            justify-content: flex-start;
            width: 100%;
            margin-top: 10px;
        }

        .agents-panel .panel-heading .btn-group.pull-right {
            display: none !important;
        }
        
        /* Mobile-specific dropdown adjustments */
        .dropdown-menu {
            position: fixed !important;
            width: 90% !important;
            max-width: 300px !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            top: auto !important;
            bottom: 10px !important;
        }
        
        .dropdown-menu.dropdown-menu-right {
            left: auto !important;
            right: 10px !important;
            transform: none !important;
        }
        
        /* Ensure select dropdowns are responsive */
        select.form-control {
            max-width: 100%;
        }
    }

    @media (min-width: 768px) {
        .mobile-btn-container {
            display: none !important;
        }
        
        /* Desktop dropdown positioning */
        .dropdown-menu-right {
            right: 0;
            left: auto;
        }
    }
    
    /* General responsive adjustments */
    .edit-dropdown-wrapper {
        position: relative;
        display: inline-block;
        margin-left: -1px; 
        max-width: 100%;
    }
    
    .edit-dropdown-wrapper select {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        padding-right: 25px;
        cursor: pointer;
        max-width: 100%;
    }
    
    .edit-dropdown-wrapper .caret {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
    }
    
    /* Modal responsiveness */
    @media (max-width: 767px) {
        .modal-dialog {
            margin: 10px;
            width: auto;
        }
        
        .modal-content {
            width: 100%;
        }
    }
    
    .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        cursor: pointer;
    }
    
    .section-number {
        display: inline-block;
        background-color: #333;
        color: white;
        width: 24px;
        height: 24px;
        text-align: center;
        border-radius: 12px;
        margin-right: 10px;
        font-size: 14px;
        line-height: 24px;
    }
    
    .section-title {
        font-size: 16px;
        flex-grow: 1;
    }
    
    .section-container {
        margin-bottom: 20px;
    }
    
    .section-content {
        padding-left: 34px;
    }
    
    .well {
        background-color: #f5f5f5;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .address-box {
        border: 1px solid #ccc;
        padding: 10px 12px;
        border-radius: 3px;
        background-color: #fff;
        margin-bottom: 10px;
    }

    .address-box input[type="checkbox"] {
        margin-right: 8px;
        transform: scale(1.2);
        cursor: pointer;
    }
    
    /* Input group responsiveness */
    .input-group {
        flex-wrap: nowrap;
    }
    
    @media (max-width: 767px) {
        .input-group {
            flex-wrap: wrap;
        }
        
        .input-group input {
            width: 100% !important;
            border-radius: 4px !important;
            margin-bottom: 5px;
        }
        
        .input-group-append {
            width: 100%;
        }
        
        .input-group-append select {
            width: 100% !important;
            border-radius: 4px !important;
            border-left: 1px solid #ced4da !important;
        }
    }
</style>

<div class="tab-pane" id="Relationships-individuals">
    <!-- Main Content -->
    <div id="RelationshipsMainContent">
        <div class="agents-panel panel panel-default">
            <div class="panel-heading clearfix">
                <h4 class="section-title1 pull-left">Relationships for Judith Abel</h4>
                
                <!-- Desktop Buttons -->
                <div class="btn-group pull-right d-none d-sm-inline-block">
                    <button type="button" class="btn btn-primary" onclick="RelationshipsUI.showCreateNew()">
                        <i class="fa fa-plus"></i> Add
                    </button>
                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                        <i class="fa fa-angle-down"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right">
                        <li><a href="{% url 'manage_agencies' %}" target="_blank">Mass Update</a></li>
                    </ul>
                </div>
                
                <!-- Mobile Buttons -->
                <div class="mobile-btn-container d-block d-sm-none">
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" onclick="RelationshipsUI.showCreateNew()">
                            <i class="fa fa-plus"></i> Add
                        </button>
                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                            <i class="fa fa-angle-down"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="{% url 'manage_agencies' %}" target="_blank">Mass Update</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="panel-body table-responsive">
                <table id="example10" class="table table-bordered table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Relationship</th>
                            <th>Name</th>
                            <th>Preview</th>
                            <th>SSN</th>
                            <th>Date of Birth</th>
                            <th>Age</th>
                            <th>Gender</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Spouse</td>
                            <td><a href="{% url 'individual_tab' 1 %}">John Doe</a></td>
                            <td><a href="mailto:john@example.com">john@example.com</a></td>
                            <td>123-456-7890</td>
                            <td>01/01/1980</td>
                            <td>44</td>
                            <td>Male</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Create New Relationship Form -->
    <div id="createNewRelationshipsContainer" style="display: none;">
        <div class="panel panel-default">
            <div class="panel-heading d-flex justify-content-between align-items-center">
                <strong>Edit Relationship</strong>
            </div>
            <hr style="margin: 0;">
            <div class="panel-body">
                <form method="post" enctype="multipart/form-data" id="activityForm">
                    {% csrf_token %}
                  <div class="form-group col-md-4">
    <label>Name <span class="text-danger">*</span></label>
    <div class="input-group" style="display: flex;">
        <input type="text" class="form-control" placeholder="Type to search" style=" width: 190px; border-top-right-radius: 0; border-bottom-right-radius: 0;">
        
        <div class="input-group-append">
            <select class="form-control form-control-sm" id="editRelationshipDropdown" style="background-color: #e9ecef;width: 90px; border-top-left-radius: 0; border-bottom-left-radius: 0; border-left: 0;">
                <option value="">Edit</option>
                <option value="existing">Use Existing</option>
                <option value="new">Create New Individual</option>
                <option value="basic">Basic Info</option>
            </select>
        </div>
    </div>
</div>

                    <div class="form-group col-md-4">
                        <label>Relationship to Individual <span class="text-danger">*</span></label>
                        <select class="form-control">
                            <option disabled selected>Select relationship</option>
                            <optgroup label="Personal">
                                <option>Common Law</option>
                                <option>Domestic Partner</option>
                                <option>Ex-Spouse</option>
                                <option>Life Partner</option>
                                <option>Significant Other</option>
                                <option>Spouse</option>
                                <option>Widow</option>
                                <option>Widower</option>
                            </optgroup>
                            <optgroup label="Family">
                                <option>Child</option>
                                <option>Foster Child</option>
                                <option>Foster Parent</option>
                                <option>Grandchild</option>
                                <option>Grandparent</option>
                                <option>In-Law</option>
                                <option>Parent</option>
                                <option>Relative</option>
                                <option>Sibling</option>
                                <option>Step Grandparent</option>
                                <option>Stepchild</option>
                                <option>Stepsibling</option>
                            </optgroup>
                            <optgroup label="Legal">
                                <option>Beneficiary</option>
                                <option>Conservatee</option>
                                <option>Conservator</option>
                                <option>Dependent</option>
                                <option>Fiduciary</option>
                                <option>Fiduciary Principal</option>
                                <option>Legal Guardian</option>
                                <option>POA Principal</option>
                                <option>Power of Attorney</option>
                                <option>Trustee</option>
                                <option>Ward</option>
                            </optgroup>
                            <optgroup label="Other">
                                <option>Other</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-group col-md-4">
                        <label>Notes</label>
                        <textarea class="form-control" rows="3"></textarea>
                    </div>
                    <hr>
                    <div class="form-group w-50">
                        <label for="correspondingToggle">Add Corresponding Relationship?</label>
                        <select id="correspondingToggle" class="form-control form-control-sm">
                            <option value="">--Select--</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>

                    <hr>
                    <div id="correspondingSection" style="display: none;">
                        <h5>
                            <strong>Corresponding Relationship</strong>
                            <small><a href="#"><i>(What is this?)</i></a></small>
                        </h5>
                        <div class="form-row">
                            <div class="form-group col-md-4">
                                <label>Name</label>
                                <p><strong>Judith Abel</strong></p>
                            </div>
                            <div class="form-group col-md-4">
                                <label>Corresponding Relationship <span class="text-danger">*</span></label>
                                <select class="form-control">
                                    <option disabled selected>Select relationship</option>
                                    <optgroup label="Personal">
                                        <option>Common Law</option>
                                        <option>Domestic Partner</option>
                                        <option>Ex-Spouse</option>
                                        <option>Life Partner</option>
                                        <option>Significant Other</option>
                                        <option>Spouse</option>
                                        <option>Widow</option>
                                        <option>Widower</option>
                                    </optgroup>
                                    <optgroup label="Family">
                                        <option>Child</option>
                                        <option>Foster Child</option>
                                        <option>Foster Parent</option>
                                        <option>Grandchild</option>
                                        <option>Grandparent</option>
                                        <option>In-Law</option>
                                        <option>Parent</option>
                                        <option>Relative</option>
                                        <option>Sibling</option>
                                        <option>Step Grandparent</option>
                                        <option>Stepchild</option>
                                        <option>Stepsibling</option>
                                    </optgroup>
                                    <optgroup label="Legal">
                                        <option>Beneficiary</option>
                                        <option>Conservatee</option>
                                        <option>Conservator</option>
                                        <option>Dependent</option>
                                        <option>Fiduciary</option>
                                        <option>Fiduciary Principal</option>
                                        <option>Legal Guardian</option>
                                        <option>POA Principal</option>
                                        <option>Power of Attorney</option>
                                        <option>Trustee</option>
                                        <option>Ward</option>
                                    </optgroup>
                                    <optgroup label="Other">
                                        <option>Other</option>
                                    </optgroup>
                                </select>
                            </div>

                            <div class="form-group col-md-4">
                                <label>Notes</label>
                                <textarea class="form-control" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <button type="submit" class="btn btn-success"><i class="fa fa-save"></i> Save</button>
                        <button type="button" class="btn btn-default" onclick="RelationshipsUI.showNotesMain()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- New Individual Modal -->
<div class="modal fade" id="newIndividualModal" tabindex="-1" role="dialog" aria-labelledby="newIndividualModalLabel">
    <div class="modal-dialog modal-md-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
                <h4 class="modal-title" id="newIndividualModalLabel"><strong>New Individual</strong></h4>
            </div>
            <div class="modal-body">
                <form id="individualForm">
                    
                    <!-- Section 1: Individual Info -->
                    <div class="section-container">
                        <div class="section-header" onclick="toggleSection(1)">
                            <div class="section-number">1</div>
                            <div class="section-title text-success">
                                Individual Info <span class="text-danger">Please review the required fields.</span>
                            </div>
                        </div>
                        <div class="section-content" id="section-1">
                            <div class="row">
                                <div class="form-group col-md-4">
                                    <label for="firstName">First Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="firstName" placeholder="">
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="middleName">Middle Name</label>
                                    <input type="text" class="form-control" id="middleName" placeholder="">
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="lastName">Last Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="lastName" placeholder="">
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-4">
                                    <label for="type">Type</label>
                                    <select class="form-control" id="type">
                                        <option value="">-- Select Type --</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="servicingAgent">Servicing Agent</label>
                                    <input type="text" class="form-control" id="servicingAgent" placeholder="Type to search">
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="email">Email</label>
                                    <input type="email" class="form-control" id="email">
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-4">
                                    <label for="businessPhone">Business Phone/Ext.</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="businessPhone">
                                        <span class="input-group-addon">ext</span>
                                    </div>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="homePhone">Home Phone/Ext.</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="homePhone">
                                        <span class="input-group-addon">ext</span>
                                    </div>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="cellPhone">Cell Phone/Ext.</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="cellPhone">
                                        <span class="input-group-addon">ext</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <!-- Section 2: Associate Individual -->
                    <div class="section-container">
    <div class="section-header" onclick="toggleSection(2)">
        <div class="section-number">2</div>
        <div class="section-title text-success">Associate Individual</div>
    </div>
    <div class="section-content" id="section-2" style="display: none;">
        <div class="form-group">
            <label for="recordTypeDropdown">Select Record Type</label>
            <select class="form-control" id="recordTypeDropdown" onchange="toggleCarrierField(this.value)">
                <option value="">-- Select Record Type --</option>
                <option value="carrier">New Carrier</option>
                <option value="vendor">Existing Carrier</option>
            </select>
            <div class="well" style="background-color: #f5f5f5; padding: 15px; margin-top: 10px;">
                <p style="margin-bottom: 0;">Track and manage carrier contacts. <a href="#">Learn more</a>.</p>
            </div>
        </div>
        
        <div id="carrierNameContainer" style="display: none;">
            <div class="form-group">
                <label for="carrierName">Carrier Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="carrierName" placeholder="">
            </div>
        </div>
    </div>
</div>


                    <hr>

                    <!-- Section 3: Address Info -->
                    <div class="section-container">
                        <div class="section-header" onclick="toggleSection(3)">
                            <div class="section-number">3</div>
                            <div class="section-title text-success">Address Info <small>(optional)</small></div>
                        </div>
                        <div class="section-content" id="section-3" style="display: none;">
                            <label class="mb-2">Addresses</label>
                            <div class="address-box">
                                <label class="d-flex align-items-center m-0" style="width: 100%;">
                                    <input type="checkbox" class="me-2">
                                    <span>Home - 245 Leatherberry Rd Carrollton, Ohio 44615</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <p class="text-muted">Fields marked with an <span class="text-danger">*</span> are required.</p>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success"><i class="fa fa-save"></i> Save</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Basic Info Modal -->
<div class="modal fade" id="basicinfoModal" tabindex="-1" role="dialog" aria-labelledby="basicinfoModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span>&times;</span></button>
                <h4 class="modal-title" id="basicinfoModalLabel">Basic Information</h4>
            </div>
            <div class="modal-body">
               
                <p class="text-danger"><strong>Please review the required fields.</strong></p>
                <form>
                    <div class="row">
                        <div class="form-group col-md-4">
                            <label>First Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" placeholder="">
                        </div>
                        <div class="form-group col-md-4">
                            <label>Middle Name</label>
                            <input type="text" class="form-control" placeholder="">
                        </div>
                        <div class="form-group col-md-4">
                            <label>Last Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" placeholder="">
                        </div>
                         <div class="form-group col-md-4">
                            <label>Date of Birth  <span class="text-danger"></span></label>
                            <input type="date" class="form-control" placeholder="">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-4">
                            <label>Gender</label>
                            <select class="form-control">
                                <option value="">-- Select Type --</option>
                                <option value="">F</option>
                                <option value="">M</option>
                            </select>
                        </div>
                        <div class="form-group col-md-4">
                            <label>SSN</label>
                            <input type="text" class="form-control" placeholder="Type to search">
                        </div>
                       <div class="form-group col-md-4">
                            <label>Smoker Status</label>
                            <select class="form-control">
                                <option value="">-- Select Type --</option>
                                <option value="">Yes</option>
                                <option value="">No</option>
                            </select>
                        </div>
                    
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success"><i class="fa fa-save"></i> Save</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Load jQuery first -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Then load Bootstrap JS -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<script>
    // Namespace all functions to avoid conflicts
    var RelationshipsUI = {
        init: function() {
            // Form submission handler
            $('#activityForm').on('submit', function(e) {
                e.preventDefault();
                RelationshipsUI.showNotesMain();
                location.reload();
            });

            // Corresponding relationship toggle
            $('#correspondingToggle').change(function() {
                $('#correspondingSection').toggle($(this).val() === 'yes');
            });
            
            // Edit relationship dropdown handler
            $('#editRelationshipDropdown').change(function() {
                var action = $(this).val();
                $(this).val(''); // Reset to "Edit" option
                
                switch(action) {
                    case 'existing':
                        RelationshipsUI.useExistingIndividual();
                        break;
                    case 'new':
                        $('#newIndividualModal').modal('show');
                        break;
                    case 'basic':
                        $('#basicinfoModal').modal('show');
                        break;
                }
            });
        },

        showCreateNew: function() {
            $('#RelationshipsMainContent').hide();
            $('#createNewRelationshipsContainer').show();
            $('html, body').animate({
                scrollTop: $('#createNewRelationshipsContainer').offset().top - 20
            }, 'smooth');
        },

        showNotesMain: function() {
            $('#RelationshipsMainContent').show();
            $('#createNewRelationshipsContainer').hide();
            $('#activityForm')[0].reset();
            $('#correspondingSection').hide();
        },

       
    };

    // Initialize when DOM is ready
    $(document).ready(function() {
        RelationshipsUI.init();
    });

function toggleSection(sectionNum) {
    // Hide all other sections
    $('.section-content').not('#section-' + sectionNum).slideUp();
    
    // Toggle the clicked section
    $('#section-' + sectionNum).slideToggle();
}

// Initialize with first section open
$(document).ready(function() {
    $('#section-1').show();
    $('#section-2').hide();
    $('#section-3').hide();
    
    // Handle opening from different triggers
    $('#newIndividualModal').on('show.bs.modal', function (e) {
        var trigger = $(e.relatedTarget);
        if(trigger.hasClass('address-info-trigger')) {
            $('.section-content').hide();
            $('#section-3').show();
        } else if(trigger.hasClass('associate-individual-trigger')) {
            $('.section-content').hide();
            $('#section-2').show();
        } else {
            // Default behavior - show first section
            $('.section-content').hide();
            $('#section-1').show();
        }
    });
});
function toggleSection(sectionNum) {
    $('.section-content').not('#section-' + sectionNum).slideUp();
    $('#section-' + sectionNum).slideToggle();
}

function toggleCarrierField(recordType) {
    const carrierContainer = $('#carrierNameContainer');
    const carrierInput = $('#carrierName');
    
    if (recordType === 'carrier') {
        carrierContainer.show();
        carrierInput.attr('placeholder', 'Enter new carrier name');
    } 
    else if (recordType === 'vendor') {
        carrierContainer.show();
        carrierInput.attr('placeholder', 'Type to search existing carriers');
    } 
    else {
        carrierContainer.hide();
        carrierInput.val('');
    }
}

// Initialize when DOM is ready
$(document).ready(function() {
    // Hide carrier name field by default
    $('#carrierNameContainer').hide();
    
    // Rest of your initialization code...
});
</script>