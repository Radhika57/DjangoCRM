{% extends "dashboard/base.html" %}
{% load static %}
{% block main-content %}

<style>
    /* Base Styles */
    .modal {
        z-index: 1060 !important; 
    }
    
    .modal-backdrop {
        z-index: 1050 !important; 
        background-color: rgba(0,0,0,0.5) !important;
    }
    
    .modal-content {
        pointer-events: auto !important;
    }
    
    /* Carrier summary sidebar styling */
    #carrier-summary {
        width: 300px;
        background: #fff;
        padding: 15px;
        border-left: 1px solid #ddd;
        position: fixed;
        right: -300px; 
        top: 50px; 
        height: calc(100vh - 50px);
        overflow-y: auto;
        z-index: 1000;
        box-shadow: -2px 0 5px rgba(0,0,0,0.1);
        transition: right 0.3s ease;
    }
    
    #carrier-summary.shown {
        right: 0;
    }
    
    .main-content-wrapper {
        width: 100%;
        transition: all 0.3s ease;
        padding-right: 0;
    }
    
    .main-content-wrapper.sidebar-shown {
        padding-right: 300px;
    }
    
    .summary-header {
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }
    
    .summary-item {
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #f5f5f5;
    }
    
    .action-buttons {
        position: fixed;
        right: 20px;
        top: 60px;
        z-index: 1010;
    }
    
    .close-sidebar {
        position: absolute;
        right: 15px;
        top: 15px;
        cursor: pointer;
        color: #999;
    }
    
    .close-sidebar:hover {
        color: #333;
    }
    
    .carrier-status-container {
        position: relative;
        z-index: 1;
    }
    
    .tab-content {
        overflow: visible;
    }

    /* Nav tabs responsiveness */
    .nav-tabs {
        display: flex;
        flex-wrap: wrap;
        white-space: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .nav-tabs > li {
        float: none;
        display: inline-block;
    }
    
   
    .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
   
    .form-control {
        max-width: 100%;
    }
    
   
    .modal-dialog {
        margin: 30px auto;
    }
    
    
    @media (max-width: 1199px) {
       
        #carrier-summary {
            width: 280px;
            right: -280px;
        }
        
        .main-content-wrapper.sidebar-shown {
            padding-right: 280px;
        }
    }

    @media (max-width: 991px) {
       
        .action-buttons {
            right: 15px;
            top: 55px;
        }
        
        .panel-body .row > [class*="col-"] {
            margin-bottom: 15px;
        }
        
        .modal-dialog {
            width: 90%;
            margin: 20px auto;
        }
    }

    @media (max-width: 768px) {
      
        #carrier-summary {
            width: 250px;
            right: -250px;
        }
        
        .main-content-wrapper.sidebar-shown {
            padding-right: 250px;
        }
        
        .action-buttons {
            top: 50px;
        }
        
        .nav-tabs > li > a {
            padding: 10px 12px;
            font-size: 14px;
        }
        
        .modal-dialog {
            margin: 10px auto;
        }
        
        .panel-heading .btn {
            margin-bottom: 10px;
        }
    }

    @media (max-width: 576px) {
        
        #carrier-summary {
            width: 100%;
            right: -100%;
        }
        
        .main-content-wrapper.sidebar-shown {
            padding-right: 0;
            transform: translateX(-100%);
        }
        
        .action-buttons {
            position: relative;
            right: auto;
            top: auto;
            margin-bottom: 15px;
            text-align: right;
        }
        
        .nav-tabs > li > a {
            padding: 8px 10px;
            font-size: 13px;
        }
        
        .modal-dialog {
            width: 95%;
            margin: 5px auto;
        }
        
        .panel-body .row > [class*="col-"] {
            margin-bottom: 10px;
        }
        
        .btn-group {
            margin-bottom: 10px;
        }
    
        .form-inline .form-group {
            display: block;
            margin-bottom: 10px;
        }
        
      
        .table-controls .col-md-6 {
            margin-bottom: 10px;
        }
        
        
        .dropdown-menu {
            position: absolute;
        }
    }
    
    
    @media (max-width: 400px) {
        .nav-tabs > li > a {
            padding: 6px 8px;
            font-size: 12px;
        }
        
        .btn {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .modal-title {
            font-size: 16px;
        }
    }
    
    
    @media (max-width: 767px) {
        .navbar-collapse {
            max-height: none;
        }
        
        .dropdown-menu {
            position: static;
            float: none;
            width: auto;
            margin-top: 0;
            background-color: transparent;
            border: 0;
            box-shadow: none;
        }
        
        .dropdown-menu > li > a {
            padding: 5px 15px;
            color: #333;
        }
    }
    
  
    .btn-file {
        position: relative;
        overflow: hidden;
    }
    
    .btn-file input[type=file] {
        position: absolute;
        top: 0;
        right: 0;
        min-width: 100%;
        min-height: 100%;
        font-size: 100px;
        text-align: right;
        filter: alpha(opacity=0);
        opacity: 0;
        outline: none;
        background: white;
        cursor: inherit;
        display: block;
    }
</style>

<!-- Action buttons -->
<div class="action-buttons">
    <div class="btn-group">
        <button id="toggle-carrier-summary" class="btn btn-default btn-sm">
            <i class="fa fa-list-alt"></i>
        </button>
        <button class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right">
            <li><a href="#"><i class="fa fa-plus"></i> Add Note</a></li>
            <li><a href="#"><i class="fa fa-calendar"></i> Schedule Activity</a></li>
            <li><a href="#"><i class="fa fa-print"></i> Print Summary</a></li>
            <li class="divider"></li>
            <li><a href="#"><i class="fa fa-cog"></i> Settings</a></li>
        </ul>
    </div>
</div>

<!-- Main content -->
<div class="main-content-wrapper">
    <div class="container-fluid">
        <div class="carrier-status-container">
            <h3><span class="badge" style="background-color: purple;">&nbsp;</span>{{carrier_details.name}}</h3>
        </div>
        
        <div role="tabpanel">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#detail">Detail</a></li>
                <li><a data-toggle="tab" href="#individuals">Individuals</a></li>
                <li><a data-toggle="tab" href="#activities">Activities</a></li>
                <li><a data-toggle="tab" href="#notes">Notes</a></li>
                <li><a data-toggle="tab" href="#forms">Forms</a></li>
                <li><a data-toggle="tab" href="#products">Products</a></li>
                <li><a data-toggle="tab" href="#websites">Websites</a></li>
                <li><a data-toggle="tab" href="#emails">Emails</a></li>
            </ul>
            
            <!-- Tab panes -->
            <div class="tab-content">
                <!-- Detail Tab -->
                <div id="detail" class="tab-pane active">
                    <form>
                        <!-- Carrier Info -->
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Carrier Info</h3>
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-md-4 col-sm-6">
                                        <div class="form-group">
                                            <label>Carrier Name <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" value="{{carrier_details.name}}" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-2 col-sm-6">
                                        <div class="form-group">
                                            <label>Abbreviation</label>
                                            <input type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-6">
                                        <div class="form-group mb-1">
                                          <label class="mb-0">Carrier Security Groups</label>
                                          <div style="border:1px solid #ced4da;border-radius:.25rem;max-height:120px;overflow-y:auto;padding:1px 5px;">
                                            <div style="padding:0;margin:0">
                                              <input type="checkbox" id="security_admin" name="security_groups[]" value="Administrator" checked 
                                                     style="margin:0 5px 0 0;vertical-align:middle">
                                              <label for="security_admin" style="margin:0;display:inline">Administrator</label>
                                            </div>
                                            <div style="padding:0;margin:0">
                                              <input type="checkbox" id="security_gem" name="security_groups[]" value="Agent GEM" 
                                                     style="margin:0 5px 0 0;vertical-align:middle">
                                              <label for="security_gem" style="margin:0;display:inline">Agent GEM</label>
                                            </div>
                                            <div style="padding:0;margin:0">
                                              <input type="checkbox" id="security_statements" name="security_groups[]" value="Agent Statements" 
                                                     style="margin:0 5px 0 0;vertical-align:middle">
                                              <label for="security_statements" style="margin:0;display:inline">Agent Statements</label>
                                            </div>
                                            <div style="padding:0;margin:0">
                                              <input type="checkbox" id="security_staff" name="security_groups[]" value="Commission Staff" 
                                                     style="margin:0 5px 0 0;vertical-align:middle">
                                              <label for="security_staff" style="margin:0;display:inline">Commission Staff</label>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    <div class="col-md-2 col-sm-6">
                                        <div class="form-group">
                                            <label>Carrier Status <span class="text-danger">*</span></label>
                                            <select class="form-control">
                                                <option selected>Active</option>
                                                <option>Inactive</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contact Info -->
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Contact Info</h3>
                            </div>
                            <div class="panel-body text-center">
                                <div class="alert alert-info">
                                    There aren't any custom fields yet<br>
                                    <small>Use custom fields to track and report on data unique to your agency.</small><br>
                                    <a href="#">How do I use custom fields?</a>
                                </div>
                                <button type="button" class="btn btn-default">Add/Edit</button>
                            </div>
                        </div>
                        
                        <!-- Custom Fields -->
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Custom Fields</h3>
                            </div>
                            <div class="panel-body text-center">
                                <div class="alert alert-info">
                                    There aren't any custom fields yet<br>
                                    <small>Use custom fields to track and report on data unique to your agency.</small><br>
                                    <a href="#">How do I use custom fields?</a>
                                </div>
                                <button type="button" class="btn btn-default">Add/Edit</button>
                            </div>
                        </div>
                        
                        <!-- Footer Buttons -->
                        <div class="well">
                            <div class="row">
                                <div class="col-xs-12 col-sm-6">
                                    <button type="submit" class="btn btn-success">Save</button>
                                    <button type="button" class="btn btn-danger">Delete</button>
                                </div>
                                <div class="col-xs-12 col-sm-6 text-right text-muted">
                                    <small>Updated by Alyson Gross on 2/17/2024 at 12:39 PM Eastern Standard Time</small>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Individuals Tab -->
                <div id="individuals" class="tab-pane fade">
                    <div class="container-fluid">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <h3 class="panel-title">Individuals of AARP</h3>
                                    </div>
                                    <div class="col-sm-6 text-right">
                                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addIndividualModal">
                                            <i class="fa fa-plus"></i> Add
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body">
                                <!-- Add Individual Modal -->
                                <div class="modal fade" id="addIndividualModal" tabindex="-1" role="dialog" aria-labelledby="addIndividualModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                                <h4 class="modal-title" id="addIndividualModalLabel">Add an Individual as a Carrier Contact</h4>
                                            </div>
                                            <div class="modal-body">
                                                <div class="form-group">
                                                    <label>Select Record Type</label>
                                                    <select class="form-control">
                                                        <option>Existing Individual</option>
                                                        <option>New Individual</option>
                                                    </select>
                                                </div>
                                                <p class="text-muted small">The individual will be added as a carrier contact. <a href="#">Learn more</a>.</p>
                                                
                                                <div class="form-group">
                                                    <label>Name <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" placeholder="Type to search">
                                                </div>
                                                
                                                <p class="text-muted small">Fields marked with an * are required.</p>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-primary">Save</button>
                                                <button type="button" class="btn btn-default">Save & Add Another</button>
                                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row table-controls">
                                    <div class="col-xs-12 col-sm-6">
                                        <div class="form-group">
                                            <input type="text" class="form-control" placeholder="Search: Type to filter (Individual Name, Type, Status)">
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-6 text-right">
                                        <div class="form-inline">
                                            <div class="form-group">
                                                <label>Show 
                                                    <select class="form-control input-sm">
                                                        <option>25</option>
                                                        <option>50</option>
                                                        <option>100</option>
                                                    </select> 
                                                    entries
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th class="sortable" data-key="name">NAME <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-key="type">TYPE <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-key="status">STATUS <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-key="lead_source">LEAD SOURCE <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-key="dob">DATE OF BIRTH <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-key="email">EMAIL <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-key="phone">BUSINESS PHONE <i class="fa fa-sort"></i></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="7" class="text-center">No data available in table</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6">
                                        <p class="text-muted">Showing 0 to 0 of 0 entries</p>
                                    </div>
                                    <div class="col-xs-12 col-sm-6 text-right">
                                        <ul class="pagination pagination-sm">
                                            <li class="enable"><a href="#">Previous</a></li>
                                            <li class="enable"><a href="#">Next</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Activities Tab -->
                <div id="activities" class="tab-pane fade">
                    <div class="container-fluid">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <h3 class="panel-title">Associated Activities</h3>
                                    </div>
                                    <div class="col-sm-6 text-right">
                                        <button type="button" class="btn btn-primary" id="showActivityForm">
                                            <i class="fa fa-plus"></i> Create New
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body">
                                <!-- Empty state content -->
                                <div id="emptyActivitiesState" class="text-center">
                                    <div class="well" style="padding: 40px;">
                                        <i class="fa fa-tasks fa-3x text-muted mb-3"></i>
                                        <h4>No activities have been associated yet</h4>
                                        <p class="text-muted">
                                            Use activities to track to-dos and follow-up reminders.<br>
                                            <a href="#">Learn more about activities</a>
                                        </p>
                                    </div>
                                </div>
                                
                                <!-- Activity Details Section -->
                                <div id="activityDetailsSection" style="display: none;">
                                    <div class="well">
                                        <h4>Activity Details</h4>
                                        
                                        <!-- Subject Section -->
                                        <div class="form-group">
                                            <label><strong>Subject *</strong></label>
                                            <input type="text" class="form-control" placeholder="Enter subject">
                                        </div>
                                        
                                        <!-- Notes Section -->
                                        <div class="form-group">
                                            <label><strong>Notes</strong></label>
                                            <textarea class="form-control" rows="3"></textarea>
                                        </div>
                                        
                                        <!-- Status Table with Dropdowns -->
                                        <div class="table-responsive">
                                            <table class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th>Status</th>
                                                        <th>Follow-up User</th>
                                                        <th>Follow-up Team</th>
                                                        <th>Due Date</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <select class="form-control">
                                                                <option>Not Started</option>
                                                                <option selected>In Progress</option>
                                                                <option>Completed</option>
                                                                <option>Cancelled</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select class="form-control">
                                                                <option>Select User</option>
                                                                <option>John Smith</option>
                                                                <option>Jane Doe</option>
                                                                <option>Mike Johnson</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <select class="form-control">
                                                                <option>Select Team</option>
                                                                <option>Sales</option>
                                                                <option>Support</option>
                                                                <option>Marketing</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <input type="date" class="form-control">
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <hr>
                                        
                                        <!-- Additional Activity Details with Dropdowns -->
                                        <h5>Additional Activity Details</h5>
                                        <div class="row">
                                            <div class="col-md-4 col-sm-6">
                                                <div class="form-group">
                                                    <label><strong>Activity Date *</strong></label>
                                                    <input type="date" class="form-control">
                                                </div>
                                                <div class="form-group">
                                                    <label><strong>Priority</strong></label>
                                                    <select class="form-control">
                                                        <option>Low</option>
                                                        <option selected>Medium</option>
                                                        <option>High</option>
                                                        <option>Urgent</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-6">
                                                <div class="form-group">
                                                    <label><strong>Type</strong></label>
                                                    <select class="form-control">
                                                        <option selected>Initial contact</option>
                                                        <option>Follow-up</option>
                                                        <option>Meeting</option>
                                                        <option>Call</option>
                                                        <option>Email</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-6">
                                                <div class="form-group">
                                                    <label><strong>Method</strong></label>
                                                    <select class="form-control">
                                                        <option selected>Email</option>
                                                        <option>Phone</option>
                                                        <option>In-person</option>
                                                        <option>Video Call</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <hr>
                                        
                                        <!-- Attachments Section -->
                                        <div class="attachment-block">
                                            <label><b>📎Attachment(s)</b></label>
                                            <div class="table-responsive">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr><th>Filename</th><th>Size</th><th>Status</th></tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td colspan="3" class="text-center" style="padding: 40px; background: #f8f9fa;">Drag files here.</td>
                                                        </tr>
                                                    </tbody>
                                                    <tfoot>
                                                        <tr>
                                                            <td colspan="3">
                                                                <input type="file" multiple class="form-control" />
                                                            </td>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>
                                        
                                        <!-- Action Buttons -->
                                        <div class="text-right">
                                            <button type="button" class="btn btn-primary">Save</button>
                                            <button type="button" class="btn btn-default" id="cancelActivity">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notes Tab -->
                <div id="notes" class="tab-pane fade">
                    <div class="container-fluid">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <h3 class="panel-title">Notes & Attachments for AARP</h3>
                                    </div>
                                    <div class="col-sm-6 text-right">
                                        <button type="button" class="btn btn-primary" id="showNoteForm">
                                            <i class="fa fa-plus"></i> Create New
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body">
                                <!-- Empty state content -->
                                <div id="emptyNotesState" class="text-center">
                                    <div class="well" style="padding: 40px;">
                                        <h4>There are no "Notes & Attachments for AARP"</h4>
                                        <p class="text-muted">
                                            This data is not available because it hasn't been created yet or you don't have permission.
                                        </p>
                                    </div>
                                </div>
                                
                                <!-- Note Creation Form -->
                                <div id="noteDetailsSection" style="display: none;">
                                    <div class="well">
                                        <h4>New Notes & Attachments</h4>
                                        
                                        <!-- Subject Section -->
                                        <div class="form-group">
                                            <label><strong>Subject *</strong></label>
                                            <input type="text" class="form-control" placeholder="Enter subject">
                                        </div>
                                        
                                        <!-- Notes Section -->
                                        <div class="form-group">
                                            <label><strong>Notes</strong></label>
                                            <textarea class="form-control" rows="5" placeholder="Type your notes here..."></textarea>
                                        </div>
                                        
                                        <hr>
                                        
                                        <!-- Attachments Section -->
                                        <div class="attachment-block">
                                            <label><b>📎Attachment(s)</b></label>
                                            <div class="table-responsive">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr><th>Filename</th><th>Size</th><th>Status</th></tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td colspan="3" class="text-center" style="padding: 40px; background: #f8f9fa;">Drag files here.</td>
                                                        </tr>
                                                    </tbody>
                                                    <tfoot>
                                                        <tr>
                                                            <td colspan="3">
                                                                <input type="file" multiple class="form-control" />
                                                            </td>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>
                                        
                                        <!-- Action Buttons -->
                                        <div class="text-right">
                                            <button type="button" class="btn btn-primary">Save</button>
                                            <button type="button" class="btn btn-default" id="cancelNote">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Forms Tab -->
                <div id="forms" class="tab-pane fade">
                    <div class="container-fluid">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <h3 class="panel-title">Forms for AARP</h3>
                                    </div>
                                    <div class="col-sm-6 text-right">
                                        <button type="button" class="btn btn-primary" id="showFormCreate">
                                            <i class="fa fa-plus"></i> Create New
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body">
                                <!-- Form creation section (hidden by default) -->
                                <div id="formCreateSection" style="display: none;">
                                    <div class="well">
                                        <h4>Upload New Form</h4>
                                        
                                        <form>
                                            <!-- Form Name -->
                                            <div class="form-group">
                                                <label><strong>Form Name *</strong></label>
                                                <input type="text" class="form-control" placeholder="Enter form name">
                                            </div>
                                            
                                            <!-- Year -->
                                            <div class="form-group">
                                                <label><strong>Year</strong></label>
                                                <input type="text" class="form-control" placeholder="Enter year">
                                            </div>
                                            
                                            <!-- Form Number -->
                                            <div class="form-group">
                                                <label><strong>Form #</strong></label>
                                                <input type="text" class="form-control" placeholder="Enter form number">
                                            </div>
                                            
                                            <!-- Coverage Type -->
                                            <div class="form-group">
                                                <label><strong>Coverage Type</strong></label>
                                                <select class="form-control">
                                                    <option value="">Select coverage type</option>
                                                    <option>Medical</option>
                                                    <option>Dental</option>
                                                    <option>Vision</option>
                                                    <option>Life</option>
                                                    <option>Disability</option>
                                                    <option>Other</option>
                                                </select>
                                            </div>
                                            
                                            <!-- File Upload -->
                                            <div class="form-group">
                                                <label><strong>Form File *</strong></label>
                                                <div class="input-group">
                                                    <span class="input-group-btn">
                                                        <span class="btn btn-default btn-file">
                                                            Browse... <input type="file" id="formFileUpload">
                                                        </span>
                                                    </span>
                                                    <input type="text" class="form-control" readonly>
                                                </div>
                                                <small class="help-block">No file chosen</small>
                                            </div>
                                            
                                            <!-- Action Buttons -->
                                            <div class="text-right">
                                                <button type="button" class="btn btn-primary">Save</button>
                                                <button type="button" class="btn btn-default" id="cancelFormCreate">Cancel</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                
                                <!-- Search and entries dropdown -->
                                <div class="row table-controls">
                                    <div class="col-xs-12 col-sm-6">
                                        <div class="form-group">
                                            <input type="text" class="form-control" placeholder="Search: Type to Show / Form Name, File, Year">
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-6 text-right">
                                        <div class="form-inline">
                                            <div class="form-group">
                                                <label>Show 
                                                    <select class="form-control input-sm">
                                                        <option>25</option>
                                                        <option>50</option>
                                                        <option>100</option>
                                                    </select> 
                                                    entries
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Forms table with sortable columns -->
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th class="sortable" data-column="form_name">
                                                    Form Name <i class="fa fa-sort"></i>
                                                </th>
                                                <th class="sortable" data-column="form_file">
                                                    Form File <i class="fa fa-sort"></i>
                                                </th>
                                                <th class="sortable" data-column="year">
                                                    Year <i class="fa fa-sort"></i>
                                                </th>
                                                <th class="sortable" data-column="form_number">
                                                    Form # <i class="fa fa-sort"></i>
                                                </th>
                                                <th class="sortable" data-column="coverage_type">
                                                    Coverage Type <i class="fa fa-sort"></i>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="5" class="text-center">No data available in table</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6">
                                        <p class="text-muted">Showing 0 to 0 of 0 entries</p>
                                    </div>
                                    <div class="col-xs-12 col-sm-6 text-right">
                                        <ul class="pagination pagination-sm">
                                            <li class="enable"><a href="#">Previous</a></li>
                                            <li class="enable"><a href="#">Next</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Products Tab -->
                <div id="products" class="tab-pane fade">
                    <div class="container-fluid">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <h3 class="panel-title">Products for AARP</h3>
                                    </div>
                                    <div class="col-sm-6 text-right">
                                        <div class="form-inline">
                                            <div class="form-group">
                                                <select class="form-control">
                                                    <option>Active Products (0)</option>
                                                    <option>Inactive Products (0)</option>
                                                </select>
                                            </div>
                                            <button id="createNewProduct" class="btn btn-primary">
                                                <i class="fa fa-plus"></i> Create New
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body">
                                <!-- Product Form (Initially Hidden) -->
                                <div id="productFormContainer" style="display: none; margin-bottom: 20px;">
                                    <div class="well">
                                        <div class="row">
                                            <div class="col-md-3 col-sm-6">
                                                <div class="form-group">
                                                    <label>Coverage Type<span class="text-danger">*</span></label>
                                                    <select class="form-control">
                                                        <option value="">Select</option>
                                                        <option>Medical</option>
                                                        <option>Dental</option>
                                                        <option>Vision</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-sm-6">
                                                <div class="form-group">
                                                    <label>Product Name<span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" placeholder="Enter Product Name">
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-sm-6">
                                                <div class="form-group">
                                                    <label>Product Effective Date</label>
                                                    <input type="text" class="form-control" placeholder="mm/dd/yyyy">
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-sm-6">
                                                <div class="form-group">
                                                    <label>Product Term Date</label>
                                                    <input type="text" class="form-control" placeholder="mm/dd/yyyy">
                                                </div>
                                            </div>
                                        </div>
                
                                        <div class="form-group">
                                            <label>Product Description</label>
                                            <textarea class="form-control" rows="3" placeholder="Enter description..."></textarea>
                                        </div>
                
                                        <div class="row">
                                            <div class="col-md-4 col-sm-6">
                                                <div class="form-group">
                                                    <label>Benefit Summary</label>
                                                    <input type="file" class="form-control">
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-6">
                                                <div class="form-group">
                                                    <label>Plan Grid</label>
                                                    <input type="file" class="form-control">
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-sm-6">
                                                <div class="form-group">
                                                    <label>Brochure</label>
                                                    <input type="file" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                
                                        <div class="form-group">
                                            <label>States</label>
                                            <div style="border: 1px solid #ced4da; border-radius: 4px; max-height: 150px; overflow-y: auto; padding: 5px;">
                                                <div class="checkbox" style="margin: 5px 0;">
                                                    <label style="display: block; padding: 3px 5px;">
                                                        <input type="checkbox" name="states[]" value="Alabama" style="margin-right: 8px;">
                                                        Alabama
                                                    </label>
                                                </div>
                                                <div class="checkbox" style="margin: 5px 0;">
                                                    <label style="display: block; padding: 3px 5px;">
                                                        <input type="checkbox" name="states[]" value="Alaska" style="margin-right: 8px;">
                                                        Alaska
                                                    </label>
                                                </div>
                                                <div class="checkbox" style="margin: 5px 0;">
                                                    <label style="display: block; padding: 3px 5px;">
                                                        <input type="checkbox" name="states[]" value="Arizona" style="margin-right: 8px;">
                                                        Arizona
                                                    </label>
                                                </div>
                                                <div class="checkbox" style="margin: 5px 0;">
                                                    <label style="display: block; padding: 3px 5px;">
                                                        <input type="checkbox" name="states[]" value="Arkansas" style="margin-right: 8px;">
                                                        Arkansas
                                                    </label>
                                                </div>
                                                <!-- Add more states as needed -->
                                            </div>
                                        </div>
                
                                        <div class="text-right">
                                            <button class="btn btn-success">Save</button>
                                            <button id="cancelNewProduct" class="btn btn-default">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                
                                <!-- Product Table -->
                                <div class="row table-controls">
                                    <div class="col-xs-12 col-sm-6">
                                        <div class="form-inline">
                                            <div class="form-group">
                                                <label>Show 
                                                    <select class="form-control input-sm">
                                                        <option>25</option>
                                                        <option>50</option>
                                                        <option>100</option>
                                                    </select> 
                                                    entries
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-6 text-right">
                                        <div class="form-inline">
                                            <div class="form-group">
                                                <label>Search:
                                                    <input type="search" class="form-control input-sm" placeholder="Type to filter (Plan Code, Coverage Type, Username)">
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                
                                <div class="table-responsive" style="margin-top: 10px;">
                                    <table class="table table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th class="sortable" data-column="product">Product <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-column="coverage">Coverage Type <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-column="effective">Product Effective Date <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-column="term">Product Term Date <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-column="modified">Last Modified By <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-column="benefit">Benefit Summary <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-column="grid">Plan Grid <i class="fa fa-sort"></i></th>
                                                <th class="sortable" data-column="brochure">Brochure <i class="fa fa-sort"></i></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="8" class="text-center">No data available in table</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                
                                <div class="row">
                                    <div class="col-xs-12 col-sm-6">
                                        <p class="text-muted">Showing 0 to 0 of 0 entries</p>
                                    </div>
                                    <div class="col-xs-12 col-sm-6 text-right">
                                        <ul class="pagination pagination-sm">
                                            <li class="enable"><a href="#">Previous</a></li>
                                            <li class="enable"><a href="#">Next</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Websites Tab -->
                <div id="websites" class="tab-pane fade">
                    <div class="container-fluid">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <h3 class="panel-title">Websites for AARP</h3>
                                    </div>
                                    <div class="col-sm-6 text-right">
                                        <button type="button" class="btn btn-primary" id="showWebsiteForm">
                                            <i class="fa fa-plus"></i> Create New
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body">
                                <!-- Empty state content -->
                                <div id="emptyWebsitesState" class="text-center">
                                    <div class="well" style="padding: 40px;">
                                        <i class="fa fa-globe fa-3x text-muted mb-3"></i>
                                        <h4>No websites have been associated yet</h4>
                                        <p class="text-muted">
                                            Websites will appear here when they're associated with this carrier.<br>
                                            <a href="#">Learn more about websites</a>
                                        </p>
                                    </div>
                                </div>
                                
                                <!-- Website Creation Form -->
                                <div id="websiteFormSection" style="display: none;">
                                    <div class="well">
                                        <h4>New Website</h4>
                                        
                                        <form>
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <div class="form-group">
                                                        <label><strong>Website Name <span class="text-danger">*</span></strong></label>
                                                        <input type="text" class="form-control" placeholder="Enter website name">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <div class="form-group">
                                                        <label><strong>URL</strong></label>
                                                        <input type="url" class="form-control" placeholder="Enter URL (e.g. https://example.com)">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xs-12 col-sm-6">
                                                    <div class="form-group">
                                                        <label><strong>Username</strong></label>
                                                        <input type="text" class="form-control" placeholder="Enter username">
                                                    </div>
                                                </div>
                                                <div class="col-xs-12 col-sm-6">
                                                    <div class="form-group">
                                                        <label><strong>Password</strong></label>
                                                        <div class="input-group">
                                                            <input type="password" class="form-control" placeholder="Enter password">
                                                            <span class="input-group-btn">
                                                                <button class="btn btn-default" type="button">
                                                                    <i class="fa fa-eye"></i>
                                                                </button>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Action Buttons -->
                                            <div class="text-right">
                                                <button type="button" class="btn btn-primary">Save</button>
                                                <button type="button" class="btn btn-default" id="cancelWebsiteCreate">Cancel</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                
                                <!-- Websites Table (shown when there are entries) -->
                                <div id="websitesTableSection" style="display: none;">
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Website Name</th>
                                                    <th>URL</th>
                                                    <th>Username</th>
                                                    <th>Password</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Will be populated dynamically -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Emails Tab -->
                <div id="emails" class="tab-pane fade">
                    <div class="container-fluid">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Emails associated with AARP</h3>
                            </div>
                            <div class="panel-body text-center">
                                <div class="well" style="padding: 40px;">
                                    <h4>No emails have been associated yet</h4>
                                    <p class="text-muted">
                                        You can associate emails that were saved to AgencyBloc using Outlook Email Sync or copy them from other records to this one.
                                    </p>
                                    <div class="mt-3">
                                        <a href="#" class="btn btn-link">Learn more about Outlook Email Sync</a><br>
                                        <a href="#" class="btn btn-link">Learn how to associate & copy emails</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Carrier Summary Sidebar -->
<div id="carrier-summary">
    <span class="close-sidebar" id="close-sidebar">&times;</span>
    
    <div class="summary-header">
        <h3><i class="fa fa-building-o"></i> Carrier Summary</h3>
    </div>
    
    <div class="summary-item">
        <h4><i class="fa fa-user"></i> Contact Info</h4>
        <p class="text-muted">Business: -</p>
        <a href="#" class="btn btn-xs btn-default"><i class="fa fa-plus"></i> Add Contact</a>
    </div>
    
    <div class="summary-item">
        <h4><i class="fa fa-globe"></i> Websites</h4>
        <p class="text-muted">No websites.</p>
        <a href="#" class="btn btn-xs btn-primary"><i class="fa fa-plus"></i> Create new</a>
    </div>
    
    <div class="summary-item">
        <h4><i class="fa fa-file-text"></i> In Force Policies</h4>
        <p>Med Supp</p>
    </div>
    
    <div class="summary-item">
        <h4><i class="fa fa-money"></i> 2025 Commissions</h4>
        <p class="text-muted">No commissions received.</p>
    </div>
    
    <div class="summary-item">
        <h4><i class="fa fa-tasks"></i> Activities Due</h4>
        <p class="text-muted">No activities.</p>
        <a href="#" class="btn btn-xs btn-success"><i class="fa fa-plus"></i> Create new</a>
    </div>
    
    <div class="summary-item">
        <h4><i class="fa fa-thumb-tack"></i> Pinned Note</h4>
        <p class="text-muted">No pinned note.</p>
        <a href="#" class="btn btn-xs btn-info"><i class="fa fa-plus"></i> Create new</a>
    </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>
<!-- Dropzone CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.css">
<!-- Dropzone JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.js"></script>
<!-- FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<script>
    $(document).ready(function() {
        // --------- Sorting logic for table columns -------------
        var sortDirections = {};
        
        $('.sortable').click(function() {
            const column = $(this).data('column') || $(this).data('key');
            const $icon = $(this).find('i');
            const table = $(this).closest("table");
            const rows = table.find("tbody > tr").toArray();
            const index = $(this).index();
            
            // Reset all icons in this table
            $(this).closest('thead').find('.sortable i')
                .removeClass('fa-sort-up fa-sort-down fa-sort-asc fa-sort-desc')
                .addClass('fa-sort');
            
            // Toggle sort direction
            sortDirections[column] = sortDirections[column] === 'asc' ? 'desc' : 'asc';
            const sortOrder = sortDirections[column] === 'asc' ? 1 : -1;
            
            // Update icon
            $icon.removeClass('fa-sort')
                 .addClass(sortDirections[column] === 'asc' ? 'fa-sort-up' : 'fa-sort-down');
            
            // Manual sorting
            rows.sort(function(a, b) {
                var A = $(a).children().eq(index).text().toUpperCase();
                var B = $(b).children().eq(index).text().toUpperCase();
                if (A < B) return -1 * sortOrder;
                if (A > B) return 1 * sortOrder;
                return 0;
            });
            
            $.each(rows, function(i, row) {
                table.children("tbody").append(row);
            });
        });
    
        // -------- Form Section Toggles ----------
        // Activities
        $('#showActivityForm').click(function() {
            $('#emptyActivitiesState').hide();
            $('#activityDetailsSection').show();
        });
        
        $('#cancelActivity').click(function() {
            $('#activityDetailsSection').hide();
            $('#emptyActivitiesState').show();
        });
        
        // Notes
        $('#showNoteForm').click(function() {
            $('#emptyNotesState').hide();
            $('#noteDetailsSection').show();
        });
        
        $('#cancelNote').click(function() {
            $('#noteDetailsSection').hide();
            $('#emptyNotesState').show();
        });
        
        // Forms
        $('#showFormCreate').click(function() {
            // Hide all table-related elements
            $('#forms .panel-body > .row:not(#formCreateSection)').hide();
            $('#forms .table-responsive').hide();
            // Show the create form
            $('#formCreateSection').show();
        });
        
        $('#cancelFormCreate').click(function() {
            // Show all table-related elements
            $('#forms .panel-body > .row:not(#formCreateSection)').show();
            $('#forms .table-responsive').show();
            // Hide the create form
            $('#formCreateSection').hide();
        });
        
        // Websites
        $('#showWebsiteForm').click(function() {
            $('#emptyWebsitesState').hide();
            $('#websiteFormSection').show();
        });
        
        $('#cancelWebsiteCreate').click(function() {
            $('#websiteFormSection').hide();
            $('#emptyWebsitesState').show();
        });
        
        // Products
        $('#createNewProduct').click(function() {
            // Hide all table-related elements
            $('#products .panel-body > .row:not(#productFormContainer)').hide();
            $('#products .table-responsive').hide();
            // Show the create form
            $('#productFormContainer').show();
        });
        
        $('#cancelNewProduct').click(function() {
            // Show all table-related elements
            $('#products .panel-body > .row:not(#productFormContainer)').show();
            $('#products .table-responsive').show();
            // Hide the create form
            $('#productFormContainer').hide();
        });
        
        // --------- Fix issue when switching tabs ------------
        $('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
            var targetTab = $(e.target).attr("href");
            
            // Reset all tabs to show table content
            $('.panel-body > .row').show();
            $('.table-responsive').show();
            // Hide all form sections
            $('[id$="Section"]').hide();
            $('[id$="State"]').show();
            $('[id$="Container"]').hide();
        });
        
        // Toggle password visibility
        $('.input-group-btn button').click(function() {
            var input = $(this).closest('.input-group').find('input');
            var icon = $(this).find('i');
            
            if (input.attr('type') === 'password') {
                input.attr('type', 'text');
                icon.removeClass('fa-eye').addClass('fa-eye-slash');
            } else {
                input.attr('type', 'password');
                icon.removeClass('fa-eye-slash').addClass('fa-eye');
            }
        });
        
        // File input styling
        $(document).on('change', '.btn-file :file', function() {
            var input = $(this),
                numFiles = input.get(0).files ? input.get(0).files.length : 1,
                label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
            input.trigger('fileselect', [numFiles, label]);
        });
        
        $('.btn-file :file').on('fileselect', function(event, numFiles, label) {
            var input = $(this).parents('.input-group').find(':text'),
                log = numFiles > 1 ? numFiles + ' files selected' : label;
            
            if (input.length) {
                input.val(log);
            }
        });
        
        // Initialize Dropzone for file uploads
        Dropzone.autoDiscover = false;
        $(".attachment-block table").each(function() {
            var dropzoneElement = $(this).find("td[colspan='3']").get(0);
            
            new Dropzone(dropzoneElement, {
                url: "/file-upload", // Set your upload URL
                autoProcessQueue: false,
                clickable: true,
                previewsContainer: false,
                dictDefaultMessage: "Drop files here to upload"
            });
        });
        
        // Handle tab persistence
        if (location.hash) {
            $('a[href="' + location.hash + '"]').tab('show');
        }
        
        $('a[data-toggle="tab"]').on('click', function(e) {
            history.pushState(null, null, $(this).attr('href'));
        });
        
        // Handle back/forward navigation
        $(window).on('popstate', function() {
            var anchor = location.hash || $('a[data-toggle="tab"]').first().attr('href');
            $('a[href="' + anchor + '"]').tab('show');
        });
        
        // Toggle carrier summary sidebar
        $('#toggle-carrier-summary').click(function(e){
            e.preventDefault();
            $('#carrier-summary').toggleClass('shown');
            $('.main-content-wrapper').toggleClass('sidebar-shown');
            
            // For mobile view, handle the transform
            if ($(window).width() <= 576) {
                if ($('#carrier-summary').hasClass('shown')) {
                    $('body').css('overflow-x', 'hidden');
                } else {
                    $('body').css('overflow-x', 'auto');
                }
            }
        });
        
        // Close sidebar button
        $('#close-sidebar').click(function(e){
            e.preventDefault();
            $('#carrier-summary').removeClass('shown');
            $('.main-content-wrapper').removeClass('sidebar-shown');
            
            // For mobile view
            if ($(window).width() <= 576) {
                $('body').css('overflow-x', 'auto');
            }
        });
       
        // Close sidebar when clicking outside on mobile
        $(document).click(function(e) {
            if ($(window).width() <= 576 && $('#carrier-summary').hasClass('shown')) {
                if (!$(e.target).closest('#carrier-summary').length && 
                    !$(e.target).closest('#toggle-carrier-summary').length) {
                    $('#carrier-summary').removeClass('shown');
                    $('.main-content-wrapper').removeClass('sidebar-shown');
                    $('body').css('overflow-x', 'auto');
                }
            }
        });
    });
    
    $(document).ready(function(){
        $('#addIndividualModal').modal({
            backdrop: true, // Shows the dark backdrop
            keyboard: true, // Allows closing with ESC key
            show: false    // Don't show immediately
        });
    });
</script>
{% endblock %}