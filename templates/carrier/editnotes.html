<div id="noteeditSection" style="display: none;">
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="note_id" id="editNoteId">
        <div class="well">
            <h4 id="noteFormTitle">Edit Notes & Attachments</h4>
            
            <!-- Subject Section -->
            <div class="form-group">
                <label><strong>Subject *</strong></label>
                <input type="text" class="form-control" id="editSubject" name="editnotesubject" placeholder="Enter subject">
            </div>
            
            <!-- Notes Section -->
            <div class="form-group">
                <label><strong>Notes</strong></label>
                <textarea class="form-control" id="editNotes" name="editnotenotes" rows="5" placeholder="Type your notes here..."></textarea>
            </div>
            <div class="checkbox checkbox-primary">
                <input id="editPinNote" type="checkbox" name="editnotepin_note">
                <label for="editPinNote">
                    Pin Note
                </label>
            </div>
            
            <hr>
            
            <!-- Attachments Section -->
            <div class="attachment-block">
                <label><b>ðŸ“ŽAttachment</b></label>
                <input type="file" name="editnoteattachment" id="edit-attachment" class="form-control" />
            </div>
            <br>
            
            <!-- Action Buttons -->
            <div class="text-right">
                <button type="submit" class="btn btn-primary">Save</button>
                <button type="button" class="btn btn-default" id="cancelEditNote">Cancel</button>
            </div>
        </div>
    </form>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle click on note subject links
    document.querySelectorAll('.note-subject-link').forEach(function (el) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            document.getElementById('editSubject').value = this.dataset.subject || '';
            document.getElementById('editNotes').value = this.dataset.notes || '';
            document.getElementById('editPinNote').checked = this.dataset.pin_note || '';;
            let attachmentUrl = this.dataset.attachment;
            let attachmentBlock = document.getElementById('edit-attachment');

            if (attachmentUrl) {
                attachmentBlock.innerHTML = `<a href="${attachmentUrl}" target="_blank">ðŸ“„ View Existing Attachment</a>`;
            } else {
                attachmentBlock.innerHTML = '';
            }
            // Show the edit section and hide table
            document.getElementById('emptyNotesState').style.display = 'none';
            document.getElementById('noteeditSection').style.display = 'block';
        });
    });

    // Handle cancel edit button
    document.getElementById('cancelEditNote')?.addEventListener('click', function() {
        document.getElementById('noteeditSection').style.display = 'none';
        document.getElementById('emptyNotesState').style.display = 'block';
    });
});
</script>